import{r as b,a as Oe,R as Le}from"./vendor-b1791c80.js";import{u as N,w as fe}from"./utils-6c4e335f.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function x(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(n){if(n.ep)return;n.ep=!0;const i=x(n);fetch(n.href,i)}})();var be={exports:{}},G={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ae=b,Me=Symbol.for("react.element"),Fe=Symbol.for("react.fragment"),Ie=Object.prototype.hasOwnProperty,Te=Ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$e={key:!0,ref:!0,__self:!0,__source:!0};function ye(s,m,x){var d,n={},i=null,u=null;x!==void 0&&(i=""+x),m.key!==void 0&&(i=""+m.key),m.ref!==void 0&&(u=m.ref);for(d in m)Ie.call(m,d)&&!$e.hasOwnProperty(d)&&(n[d]=m[d]);if(s&&s.defaultProps)for(d in m=s.defaultProps,m)n[d]===void 0&&(n[d]=m[d]);return{$$typeof:Me,type:s,key:i,ref:u,props:n,_owner:Te.current}}G.Fragment=Fe;G.jsx=ye;G.jsxs=ye;be.exports=G;var e=be.exports,re={},he=Oe;re.createRoot=he.createRoot,re.hydrateRoot=he.hydrateRoot;const ze="modulepreload",Pe=function(s){return"/Lista_Cotizacion/"+s},pe={},Be=function(m,x,d){if(!x||x.length===0)return m();const n=document.getElementsByTagName("link");return Promise.all(x.map(i=>{if(i=Pe(i),i in pe)return;pe[i]=!0;const u=i.endsWith(".css"),w=u?'[rel="stylesheet"]':"";if(!!d)for(let r=n.length-1;r>=0;r--){const j=n[r];if(j.href===i&&(!u||j.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${w}`))return;const S=document.createElement("link");if(S.rel=u?"stylesheet":ze,u||(S.as="script",S.crossOrigin=""),S.href=i,document.head.appendChild(S),u)return new Promise((r,j)=>{S.addEventListener("load",r),S.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>m()).catch(i=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i})},He=.18;function P(s){if(!isFinite(s))return 0;const m=Math.round(s*100)/100;return parseFloat(m.toFixed(2))}function ae(s){let m=1;const x=s.filter(d=>parseFloat(String(d).replace(/[^\d.-]/g,""))>0);for(const d of x)m*=1-parseFloat(d)/100;return P((1-m)*100)}function oe(s,m=[]){if(!s)return{neto:0,final:0,priceAfterHiddenDiscounts:0,effectiveHiddenDiscount:0,effectiveProductDiscount:0};const{precio_lista:x=0,sinDescuentos:d=!1}=s;let n=x,i=x;if(!d){const h=m.filter(F=>parseFloat(String(F).replace(/[^\d.-]/g,""))>0);for(const F of h)n*=1-parseFloat(F)/100,i=n}const u=d?[]:[s.desc1||0,s.desc2||0,s.desc3||0,s.desc4||0].filter(h=>h>0);for(const h of u)n*=1-h/100;const w=[s.descManual1||0,s.descManual2||0,s.descManual3||0].filter(h=>h>0);for(const h of w)n*=1-h/100;const g=P(n),S=P(g*(1+He)),r=d?0:P((1-i/x)*100);let j=100;if(!d){const h=[s.desc1||0,s.desc2||0,s.desc3||0,s.desc4||0];for(const F of h)F>0&&(j*=1-F/100)}const f=[s.descManual1||0,s.descManual2||0,s.descManual3||0];for(const h of f)h>0&&(j*=1-h/100);const $=P((100-j)*100)/100;return{neto:g,final:S,priceAfterHiddenDiscounts:P(i),effectiveHiddenDiscount:r,effectiveProductDiscount:$}}function Ve(s,m){const[x,d]=b.useState(s);return b.useEffect(()=>{const n=setTimeout(()=>{d(s)},m);return()=>{clearTimeout(n)}},[s,m]),x}const Ge=[{codigo:"76227",linea:"RESALTADORES",nombre:"RESALTADOR VINIFAN MILDLINER MIX COLOR EST X12 UND",precioLista:17.55,stock:45,desc1:0,desc2:0,desc3:0,desc4:0},{codigo:"76225",linea:"RESALTADORES",nombre:"RESALTADOR VINIFAN MILDLINER CÃLIDOS EST X24 UND",precio:37.58,stock:23,desc1:0,desc2:25,desc3:0,desc4:0},{codigo:"76226",linea:"RESALTADORES",nombre:"RESALTADOR VINIFAN MILDLINER FRIOS EST X24 UND",precioLista:37.58,stock:18,desc1:0,desc2:25,desc3:0,desc4:0},{codigo:"79102",linea:"BORRADORES",nombre:"BORRADOR VINIFAN BLANCO CHICO DISP X 30 UND",precio:13.19,stock:67,desc1:5,desc2:15,desc3:0,desc4:0},{codigo:"79101",linea:"BORRADORES",nombre:"BORRADOR VINIFAN BLANCO GRANDE DISP X 20 UND",precioLista:11.5,stock:34,desc1:2,desc2:0,desc3:4,desc4:0},{codigo:"79112",linea:"BORRADORES",nombre:"BORRADOR VINIFAN NEGRO GRANDE DISP X 20 UND",precioLista:9.7,stock:12,desc1:5,desc2:3,desc3:0,desc4:0}];function We({data:s,formatMoney:m,descOcultos:x,descManualCount:d,setDescManualCount:n,updateRow:i,sortKey:u,sortDir:w,handleSort:g}){const S=`
    7%            /* cÃ³digo */
    30%           /* nombre - espacio prioritario */
    5%            /* stock */
    7%            /* precio base */
    5% 5% 5% 5%  /* descuentos */
    6%            /* manual 1 */
    ${d>=2?"5% ":""}  /* manual 2 - reducido para balance */
    ${d>=3?"5% ":""}  /* manual 3 - reducido para balance */
    4%            /* sin desc */
    7%            /* s/igv */
    7%            /* c/igv */
  `.replace(/\s+/g," ").trim();return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"grid gap-0 w-full min-w-[1000px]",style:{gridTemplateColumns:S},children:[e.jsxs("div",{className:"contents",children:[e.jsxs("button",{onClick:()=>g("codigo"),className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-2 py-2 border-r border-blue-600 flex items-center justify-center hover:bg-blue-700 transition-colors",title:"Ordenar por cÃ³digo",children:["cÃ³digo",u==="codigo"&&e.jsx("span",{className:"ml-1 text-xs",children:w==="asc"?"â–²":"â–¼"})]}),e.jsxs("button",{onClick:()=>g("nombre"),className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-4 py-3 border-r border-blue-600 flex items-start hover:bg-blue-700 transition-colors",title:"Ordenar por nombre",children:["nombre",u==="nombre"&&e.jsx("span",{className:"ml-1 text-xs",children:w==="asc"?"â–²":"â–¼"})]}),e.jsxs("button",{onClick:()=>g("stock"),className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center hover:bg-blue-700 transition-colors",title:"Ordenar por stock",children:["stock",u==="stock"&&e.jsx("span",{className:"ml-1 text-xs",children:w==="asc"?"â–²":"â–¼"})]}),e.jsxs("button",{onClick:()=>g("precio_lista"),className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-2 py-2 border-r border-blue-600 flex items-center justify-center hover:bg-blue-700 transition-colors",title:"Ordenar por precio base",children:["precio base",u==="precio_lista"&&e.jsx("span",{className:"ml-1 text-xs",children:w==="asc"?"â–²":"â–¼"})]}),e.jsx("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center",children:"desc1"}),e.jsx("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center",children:"desc2"}),e.jsx("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center",children:"desc3"}),e.jsx("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center",children:"desc4"}),e.jsxs("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center",children:[e.jsx("span",{className:"hidden sm:inline",children:"Manual 1"}),e.jsx("span",{className:"sm:hidden",children:"M1"})]}),d>=2&&e.jsxs("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center",children:[e.jsx("span",{className:"hidden sm:inline",children:"Manual 2"}),e.jsx("span",{className:"sm:hidden",children:"M2"})]}),d>=3&&e.jsxs("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-3 border-r border-blue-600 flex items-center justify-center",children:[e.jsx("span",{className:"hidden sm:inline",children:"Manual 3"}),e.jsx("span",{className:"sm:hidden",children:"M3"})]}),e.jsx("div",{className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-1 py-2 border-r border-blue-600 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"hidden md:inline",children:"sin desc."}),e.jsx("span",{className:"md:hidden",children:"?"})]})}),e.jsxs("button",{onClick:()=>g("neto"),className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-2 py-2 border-r border-blue-600 flex items-center justify-center hover:bg-blue-700 transition-colors",title:"Ordenar por precio sin IGV",children:[e.jsx("span",{className:"hidden sm:inline",children:"s/igv"}),e.jsx("span",{className:"sm:hidden",children:"s/I"}),u==="neto"&&e.jsx("span",{className:"ml-1 text-xs",children:w==="asc"?"â–²":"â–¼"})]}),e.jsxs("button",{onClick:()=>g("final"),className:"sticky top-0 z-10 bg-blue-800 text-white font-bold text-sm shadow-md px-2 py-2 flex items-center justify-center hover:bg-blue-700 transition-colors",title:"Ordenar por precio con IGV",children:[e.jsx("span",{className:"hidden sm:inline",children:"c/igv"}),e.jsx("span",{className:"sm:hidden",children:"c/I"}),u==="final"&&e.jsx("span",{className:"ml-1 text-xs",children:w==="asc"?"â–²":"â–¼"})]})]}),e.jsx("div",{className:"contents overflow-y-auto max-h-[540px]",children:s.map((r,j)=>e.jsxs("div",{className:"contents",children:[e.jsx("div",{className:"px-2 py-2 font-mono text-sm border-r border-gray-200 border-b flex items-center justify-center hover:bg-gray-50",children:r.codigo}),e.jsx("div",{className:"px-4 py-3 border-r border-gray-200 border-b flex items-start hover:bg-gray-50",children:e.jsx("div",{className:"font-medium text-sm leading-relaxed break-words line-clamp-3 hover:line-clamp-none hover:whitespace-normal transition-all duration-200 cursor-help w-full",title:r.nombre,children:r.nombre})}),e.jsx("div",{className:"px-1 py-2 text-center border-r border-gray-200 border-b flex items-center justify-center hover:bg-gray-50",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${(r.stock||0)>20?"bg-green-100 text-green-800":(r.stock||0)>10?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:r.stock||0})}),e.jsx("div",{className:"px-2 py-2 text-right tabular-nums font-mono text-sm border-r border-gray-200 border-b flex items-center justify-end hover:bg-gray-50",children:m(r.precio_lista)}),e.jsx("div",{className:"px-1 py-2 text-right tabular-nums font-mono text-gray-500 text-sm border-r border-gray-200 border-b flex items-center justify-end hover:bg-gray-50",children:r.desc1?parseFloat(r.desc1).toFixed(2):"0.00"}),e.jsx("div",{className:"px-1 py-2 text-right tabular-nums font-mono text-gray-500 text-sm border-r border-gray-200 border-b flex items-center justify-end hover:bg-gray-50",children:r.desc2?parseFloat(r.desc2).toFixed(2):"0.00"}),e.jsx("div",{className:"px-1 py-2 text-right tabular-nums font-mono text-gray-500 text-sm border-r border-gray-200 border-b flex items-center justify-end hover:bg-gray-50",children:r.desc3?parseFloat(r.desc3).toFixed(2):"0.00"}),e.jsx("div",{className:"px-1 py-2 text-right tabular-nums font-mono text-gray-500 text-sm border-r border-gray-200 border-b flex items-center justify-end hover:bg-gray-50",children:r.desc4?parseFloat(r.desc4).toFixed(2):"0.00"}),e.jsx("div",{className:"px-1 py-2 text-center border-r border-gray-200 border-b flex items-center justify-center hover:bg-gray-50",children:e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",className:"w-14 border border-gray-300 rounded px-1 py-1 text-right tabular-nums text-sm",value:r.descManual1,onChange:f=>i(j,"descManual1",f.target.value),title:"Descuentos manuales - siempre aplicables"})}),d>=2&&e.jsx("div",{className:"px-1 py-2 text-center border-r border-gray-200 border-b flex items-center justify-center hover:bg-gray-50",children:e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",className:"w-14 border border-gray-300 rounded px-1 py-1 text-right tabular-nums text-sm",value:r.descManual2,onChange:f=>i(j,"descManual2",f.target.value),title:"Descuentos manuales - siempre aplicables"})}),d>=3&&e.jsx("div",{className:"px-1 py-2 text-center border-r border-gray-200 border-b flex items-center justify-center hover:bg-gray-50",children:e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",className:"w-14 border border-gray-300 rounded px-1 py-1 text-right tabular-nums text-sm",value:r.descManual3||0,onChange:f=>i(j,"descManual3",f.target.value),title:"Descuentos manuales - siempre aplicables"})}),e.jsx("div",{className:"px-1 py-2 text-center border-r border-gray-200 border-b flex items-center justify-center hover:bg-gray-50",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2",checked:r.sinDescuentos||!1,onChange:f=>i(j,"sinDescuentos",f.target.checked),title:"Salta descuentos fijos y ocultos (mantiene descuentos manuales)"})}),e.jsx("div",{className:"px-2 py-2 text-right tabular-nums font-mono text-green-700 text-sm border-r border-gray-200 border-b flex items-center justify-end hover:bg-gray-50",children:(()=>{const f=oe(r,x);return m(f.neto)})()}),e.jsx("div",{className:"px-2 py-2 text-right tabular-nums font-mono font-bold text-blue-700 text-sm border-b flex items-center justify-end hover:bg-gray-50",children:(()=>{const f=oe(r,x);return m(f.final)})()})]},r.idx))})]})})}const Ue="PEN";function et(s){return isFinite(s)?parseFloat(s.toFixed(2)):0}function ge(s){return new Intl.NumberFormat("es-PE",{style:"currency",currency:Ue}).format(s||0)}function tt(s){if(!s)return"";const x=new Date-s,d=Math.floor(x/(1e3*60)),n=Math.floor(x/(1e3*60*60)),i=Math.floor(x/(1e3*60*60*24));return d<60?`hace ${d} min`:n<24?`hace ${n}h`:`hace ${i} dÃ­as`}const qe=s=>{const[m,x]=b.useState(null);return b.useEffect(()=>{Be(()=>import("./Cotizacion-12040938.js"),["assets/Cotizacion-12040938.js","assets/vendor-b1791c80.js","assets/utils-6c4e335f.js"]).then(d=>{x(()=>d.default)})},[]),m?e.jsx(m,{...s}):e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Cargando CotizaciÃ³n..."}),e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"})]})})};function Je(){const[s,m]=b.useState([]),[x,d]=b.useState(!0),[n,i]=b.useState("TODAS"),[u,w]=b.useState(""),[g,S]=b.useState([0,0,0,0]),[r,j]=b.useState(1),[f,$]=b.useState({vinifan:!0,viniball:!0,representadas:!0}),[h,F]=b.useState("codigo"),[W,ce]=b.useState("asc"),[je,U]=b.useState("catalog"),q=Ve(u,300),ie=b.useMemo(()=>[...new Set(s.map(l=>l.linea).filter(Boolean))].sort(),[s]);b.useMemo(()=>["vinifan","viniball","representadas"].filter(l=>f[l]),[f]);const[Xe,le]=b.useState(!1),[Ye,de]=b.useState(null);b.useEffect(()=>{Ce()},[n,u,f]);const C=b.useMemo(()=>{let t=s;if(t=t.filter(c=>!(c.categoria==="vinifan"&&!f.vinifan||c.categoria==="viniball"&&!f.viniball||c.categoria==="representadas"&&!f.representadas)),n!=="TODAS"&&(t=t.filter(c=>c.linea===n)),q.trim()){const c=q.trim().toLowerCase();t=t.filter(p=>String(p.codigo).toLowerCase().includes(c)||String(p.nombre).toLowerCase().includes(c))}return[...t].sort((c,p)=>{let y=0;return h==="codigo"?y=String(c.codigo).localeCompare(String(p.codigo),void 0,{numeric:!0,sensitivity:"base"}):h==="linea"?y=String(c.linea).localeCompare(String(p.linea),void 0,{sensitivity:"base"}):h==="categoria"?y=String(c.categoria).localeCompare(String(p.categoria),void 0,{sensitivity:"base"}):h==="nombre"?y=String(c.nombre).localeCompare(String(p.nombre),void 0,{sensitivity:"base"}):h==="precio_lista"?y=(c.precio_lista||0)-(p.precio_lista||0):h==="stock"?y=(c.stock||0)-(p.stock||0):h==="neto"?y=(c.neto||0)-(p.neto||0):h==="final"&&(y=(c.final||0)-(p.final||0)),W==="asc"?y:-y}).map(c=>{const{neto:p,final:y}=oe(c,g);return{...c,neto:p,final:y}})},[s,f,n,q,g,h,W]);b.useEffect(()=>{ve(),De(),_e()},[]),b.useEffect(()=>{Se()},[g]);function ve(){try{const l=localStorage.getItem("catalogo_data");if(l){const{data:c}=JSON.parse(l);console.log("CatÃ¡logo cargado desde localStorage:",c.length,"productos"),m(c),d(!1);return}}catch(l){console.warn("Error loading saved catalog:",l)}console.log("Cargando catÃ¡logo desde JSON");const t=Ge.map((l,c)=>({...l,idx:c,precio_lista:l.precio,descManual1:0,descManual2:0,descManual3:0,sinDescuentos:!1}));m(t),d(!1)}function Ne(t,l,c){m(p=>{const y=[...p],I=C[t];if(!I)return p;const v=s.findIndex(A=>A.idx===I.idx);if(v===-1)return p;let E;return l==="sinDescuentos"?E=!!c:E=parseFloat(String(c).replace(/[^\d.-]/g,""))||0,y[v]={...y[v],[l]:E},y})}function we(t){h===t?ce(l=>l==="asc"?"desc":"asc"):(F(t),ce("asc"))}function me(t,l){S(c=>{const p=c.slice();return p[t]=Math.max(0,parseFloat(String(l).replace(/[^\d.-]/g,""))||0),p})}function Se(){const t={descOcultos:g,timestamp:Date.now()};localStorage.setItem("precios_descuentos",JSON.stringify(t))}function De(){try{const t=localStorage.getItem("precios_descuentos");if(t){const{descOcultos:l}=JSON.parse(t);S(l)}}catch(t){console.warn("Error loading saved discounts:",t)}}function _e(){try{const t=localStorage.getItem("search_filters");if(t){const{selectedLine:l,search:c,categoriasActivas:p,timestamp:y}=JSON.parse(t),I=24*60*60*1e3;Date.now()-y<I&&(i(l||"TODAS"),w(c||""),$(p||{vinifan:!0,viniball:!0,representadas:!0}),le(!0),de(new Date(y)))}}catch(t){console.warn("Error loading saved search filters:",t)}}function Ce(){const t={selectedLine:n,search:u,categoriasActivas:f,timestamp:Date.now()};localStorage.setItem("search_filters",JSON.stringify(t)),le(!0),de(new Date)}function ue(){if(!C.length)return;const t=N.book_new(),l=n==="TODAS"?[...new Set(C.map(v=>v.linea))].filter(Boolean):[n];l.length===0&&l.push("GENERAL");for(const v of l){const E=v==="GENERAL"?C:C.filter(o=>o.linea===v);if(E.length===0)continue;const A=ae(g),B=["codigo","linea","nombre","precio_lista","desc_cliente_%","desc_fijos_1_%","desc_fijos_2_%","desc_fijos_3_%","desc_fijos_4_%"],V=[];for(let o=1;o<=r;o++)V.push(`desc_adicionales_${o}_%`);const k=[...B,...V,"precio_neto","con_igv"],M=[k,...E.map(o=>{const D=[o.codigo??"",o.linea??"",o.nombre??"",o.precio_lista,o.sinDescuentos?0:A,o.sinDescuentos?0:o.desc1||0,o.sinDescuentos?0:o.desc2||0,o.sinDescuentos?0:o.desc3||0,o.sinDescuentos?0:o.desc4||0],a=[];for(let R=1;R<=r;R++)a.push(o[`descManual${R}`]||0);return[...D,...a,o.neto,o.final]})],O=N.aoa_to_sheet(M);O["!autofilter"]={ref:N.encode_range(N.decode_range(O["!ref"]))};const H=[{wch:12},{wch:16},{wch:40},{wch:14},{wch:18},{wch:16},{wch:16},{wch:16},{wch:16}],L=[];for(let o=1;o<=r;o++)L.push({wch:18});const J=[...H,...L,{wch:14},{wch:14}];O["!cols"]=J,O["!freeze"]={xSplit:0,ySplit:1};const X=3,Y=4,Q=5,Z=9,T=k.length-2,K=k.length-1;for(let o=0;o<k.length;o++){const D=O[N.encode_cell({r:0,c:o})];D&&(D.s={font:{bold:!0}})}const ee=new Set([X,T,K]);for(let o=1;o<M.length;o++)for(const D of ee){const a=O[N.encode_cell({r:o,c:D})];a&&(a.z="#,##0.00")}const te=new Set([Y,...Array.from({length:4},(o,D)=>Q+D),...Array.from({length:r},(o,D)=>Z+D)]);for(let o=1;o<M.length;o++)for(const D of te){const a=O[N.encode_cell({r:o,c:D})];a&&typeof a.v=="number"&&(a.t="n")}const z=(v==="GENERAL"?"GENERAL":v||"Sheet").slice(0,31).replace(/[/\\?*[\]:]/g,"_");N.book_append_sheet(t,O,z)}const c=new Date,p=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}_${String(c.getHours()).padStart(2,"0")}-${String(c.getMinutes()).padStart(2,"0")}`,y=n==="TODAS"?"TODAS":n||"GENERAL";g.map(v=>String(parseFloat(String(v).replace(/[^\d.-]/g,""))||0).replace(/\./g,"-")).join("-");const I=`lista_precios_${y.toLowerCase()}_${p}.xlsx`;fe(t,I)}function xe(){if(!C.length)return;const t=N.book_new(),l=n==="TODAS"?[...new Set(C.map(v=>v.linea))].filter(Boolean):[n];l.length===0&&l.push("GENERAL");for(const v of l){const E=v==="GENERAL"?C:C.filter(a=>a.linea===v);if(E.length===0)continue;const A=ae(g),B=["codigo","linea","nombre","stock","precio_lista"],V=A>0?["descuento_cliente_%"]:[],k=[];for(let a=1;a<=4;a++)E.some(_=>(_[`desc${a}`]||0)>0&&!_.sinDescuentos)&&k.push(`desc_fijos_${a}_%`);const M=[];for(let a=1;a<=r;a++)E.some(_=>(_[`descManual${a}`]||0)>0)&&M.push(`desc_adicionales_${a}_%`);const O=[...B,...V,...k,...M,"precio_unitario_neto","precio_unitario_igv","unidades"],H=[O,...E.map(a=>{const _=[a.codigo??"",a.linea??"",a.nombre??"",a.stock??0,a.precio_lista],R=A>0?[a.sinDescuentos?0:A]:[],ke=k.map((Ee,se)=>{const ne=se+1;return a.sinDescuentos?0:a[`desc${ne}`]||0}),Re=M.map((Ee,se)=>{const ne=se+1;return a[`descManual${ne}`]||0});return[..._,...R,...ke,...Re,a.neto,a.final,""]})],L=N.aoa_to_sheet(H);L["!autofilter"]={ref:N.encode_range(N.decode_range(L["!ref"]))};const J=[{wch:12},{wch:16},{wch:40},{wch:10},{wch:14}],X=A>0?[{wch:18}]:[],Y=k.map(()=>({wch:16})),Q=M.map(()=>({wch:18})),Z=[{wch:18},{wch:18},{wch:12}];L["!cols"]=[...J,...X,...Y,...Q,...Z],L["!freeze"]={xSplit:0,ySplit:1};let T=B.length;A>0&&(T+=1),T+=k.length,T+=M.length;const K=T,ee=T+1;for(let a=0;a<O.length;a++){const _=L[N.encode_cell({r:0,c:a})];_&&(_.s={font:{bold:!0}})}const te=new Set([4,K,ee]);for(let a=1;a<H.length;a++)for(const _ of te){const R=L[N.encode_cell({r:a,c:_})];R&&(R.z="#,##0.00")}const z=new Set;let o=B.length;A>0&&(z.add(o),o+=1);for(let a=0;a<k.length;a++)z.add(o+a);o+=k.length;for(let a=0;a<M.length;a++)z.add(o+a);for(let a=1;a<H.length;a++)for(const _ of z){const R=L[N.encode_cell({r:a,c:_})];R&&typeof R.v=="number"&&(R.t="n")}const D=(v==="GENERAL"?"GENERAL":v||"Sheet").slice(0,31).replace(/[/\\?*[\]:]/g,"_");N.book_append_sheet(t,L,D)}const c=new Date,p=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}_${String(c.getHours()).padStart(2,"0")}-${String(c.getMinutes()).padStart(2,"0")}`,I=`hoja_pedido_${(n==="TODAS"?"TODAS":n||"GENERAL").toLowerCase()}_${p}.xlsx`;fe(t,I)}return je==="quotation"?e.jsx(qe,{onBack:()=>U("catalog"),catalogData:s,descOcultos:g}):e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("div",{className:"bg-gray-100 p-1 rounded-lg flex",children:[e.jsx("button",{onClick:()=>U("catalog"),className:"px-4 py-2 rounded-md text-sm font-medium transition-all bg-blue-600 text-white shadow-md",children:"ðŸ“‹ CatÃ¡logo"}),e.jsx("button",{onClick:()=>U("quotation"),className:"px-4 py-2 rounded-md text-sm font-medium transition-all bg-purple-600 text-white shadow-md",children:"ðŸ§¾ CotizaciÃ³n"})]})}),e.jsxs("div",{className:"block md:hidden space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1",children:"CategorÃ­a"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-2 py-2 bg-white text-sm",value:n,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"TODAS",children:"TODAS"}),ie.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",className:"border border-gray-300 rounded-md px-2 py-2 text-sm",placeholder:"Buscar producto",value:u,onChange:t=>w(t.target.value)})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700 mb-1",children:"Desc. ocultos (%)"}),e.jsx("div",{className:"grid grid-cols-4 gap-1",children:[0,1,2,3].map(t=>e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",className:"border border-gray-300 rounded px-1 py-1 text-xs text-center",placeholder:`v${t+1}`,value:g[t],onChange:l=>me(t,l.target.value)},t))}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Columnas manuales:"}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:r})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r<3&&e.jsx("button",{onClick:()=>j(Math.min(3,r+1)),className:"w-6 h-6 bg-green-500 hover:bg-green-600 text-white rounded text-xs font-medium flex items-center justify-center transition-colors",title:"Agregar columna manual",children:"+"}),r>1&&e.jsx("button",{onClick:()=>j(Math.max(1,r-1)),className:"w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded text-xs font-medium flex items-center justify-center transition-colors",title:"Quitar columna manual",children:"âˆ’"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:ue,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-3 py-1.5 rounded-md font-medium text-xs flex items-center justify-center gap-1 shadow-md",title:"Lista de precios con descuentos aplicados para compartir con clientes",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"ðŸ’° Lista de Precios"]}),e.jsxs("button",{onClick:xe,className:"w-full bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-md font-medium text-xs flex items-center justify-center gap-1",title:"Hoja de pedido con stock disponible y columna para ingresar cantidades",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ðŸ“ Hoja de Pedido"]})]})]}),e.jsxs("div",{className:"hidden md:flex md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"CategorÃ­a"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-2 bg-white",value:n,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"TODAS",children:"TODAS"}),ie.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",className:"border border-gray-300 rounded-md px-3 py-2",placeholder:"Buscar por cÃ³digo o nombre del producto",value:u,onChange:t=>w(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-800",children:"ðŸ·ï¸ CategorÃ­as Principales"}),e.jsxs("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded font-medium",children:[Object.values(f).filter(Boolean).length,"/3 activas"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f.vinifan,onChange:t=>$(l=>({...l,vinifan:t.target.checked})),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-800",children:"ðŸŽ¨ Vinifan (ArtÃ­culos de dibujo y escritura)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f.viniball,onChange:t=>$(l=>({...l,viniball:t.target.checked})),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-800",children:"ðŸ€ Viniball (Pelotas y mascotas)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f.representadas,onChange:t=>$(l=>({...l,representadas:t.target.checked})),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-800",children:"ðŸ¢ Representadas (Productos de marca)"})]})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 p-2 bg-gray-50 rounded",children:"Las categorÃ­as activas se mostrarÃ¡n en el catÃ¡logo. Los descuentos se aplican automÃ¡ticamente segÃºn la configuraciÃ³n de cada categorÃ­a."})]}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 mb-1",children:["Descuentos cliente",g.some(t=>t>0)&&e.jsxs("span",{className:"ml-2 text-blue-600 font-bold",children:["(Total: ",parseFloat(ae(g)).toFixed(2),"%)"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1",children:[0,1,2,3].map(t=>e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",className:"border border-gray-300 rounded px-2 py-1 text-sm text-center",placeholder:`v${t+1}`,value:g[t],onChange:l=>me(t,l.target.value)},t))}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Columnas manuales:"}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:r})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r<3&&e.jsx("button",{onClick:()=>j(Math.min(3,r+1)),className:"w-6 h-6 bg-green-500 hover:bg-green-600 text-white rounded text-xs font-medium flex items-center justify-center transition-colors",title:"Agregar columna manual",children:"+"}),r>1&&e.jsx("button",{onClick:()=>j(Math.max(1,r-1)),className:"w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded text-xs font-medium flex items-center justify-center transition-colors",title:"Quitar columna manual",children:"âˆ’"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ue,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-1 shadow-md",title:"Lista de precios con descuentos aplicados para compartir con clientes",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"ðŸ’° Lista de Precios"]}),e.jsxs("button",{onClick:xe,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-1",title:"Hoja de pedido con stock disponible y columna para ingresar cantidades",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ðŸ“ Hoja de Pedido"]})]})]})]})}),e.jsx("main",{className:"max-w-7xl mx-auto px-2 sm:px-4 py-4 sm:py-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[e.jsx("div",{className:"relative",children:C.length===0&&!x?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx("svg",{className:"h-12 w-12 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-lg font-medium",children:"No se encontraron productos."}),e.jsx("p",{className:"text-sm",children:"Intenta ajustar tus filtros o bÃºsqueda."})]}):e.jsx(We,{data:C,formatMoney:ge,descOcultos:g,descManualCount:r,setDescManualCount:j,updateRow:Ne,sortKey:h,sortDir:W,handleSort:we})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between px-3 sm:px-4 py-3 sm:py-4 bg-gray-50 border-t border-gray-200 text-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-gray-600 mb-3 sm:mb-0",children:[x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Cargando..."})]}):e.jsxs("span",{className:"font-medium text-xs sm:text-sm",children:[C.length," registros"]}),n!=="TODAS"&&e.jsxs("span",{className:"text-gray-500 text-xs sm:text-sm",children:["â€¢ LÃ­nea: ",e.jsx("span",{className:"font-medium text-gray-700",children:n})]}),u&&e.jsxs("span",{className:"text-gray-500 text-xs sm:text-sm",children:["â€¢ BÃºsqueda: ",e.jsxs("span",{className:"font-medium text-gray-700",children:['"',u,'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 text-xs sm:text-sm",children:"Total visible:"}),e.jsx("span",{className:"font-bold text-base sm:text-lg text-blue-700",children:ge(C.reduce((t,l)=>t+(l.final||0),0))})]})]})]})})]})}re.createRoot(document.getElementById("root")).render(e.jsx(Le.StrictMode,{children:e.jsx(Je,{})}));export{ge as a,oe as c,tt as f,e as j,et as t,Ve as u};
